# Telegram Bot Proxy

A Rust-based service that provides an HTTP API for sending messages via Telegram bot, with channel subscription management.

## Features

- Telegram bot interface for user subscriptions
- HTTP API for sending messages to channels
- Broadcast messages to all subscribers (admin only)
- Channel-based message routing
- SQLite database for persistent storage

## Prerequisites

- Rust 1.90.0 or later
- SQLite
- Telegram Bot Token (from @BotFather)

## Configuration

Load environment variable as per `.env.example`.

## Setup

```bash
# Only needed for development, it's autogenerated at runtime
cargo sqlx db reset

# Start the service
cargo run --release
```

## Docker

```bash
docker build -t telegram-bot-proxy .
docker run -e TELOXIDE_TOKEN=... -e DATABASE_URL=... -e SUPER_SECRET_KEY=... -p 8100:8080 telegram-bot-proxy
```

## Bot Commands

Users interact with the bot via Telegram:

- `/subscribe <channel_name>` - Subscribe to a channel
- `/unsubscribe <channel_name>` - Unsubscribe from a channel

## API Endpoints

### Health Check

```
GET /health
```

### Send Message to Channel

```
POST /send-message
Content-Type: application/json

{
  "channel_name": "example_channel",
  "message": "Your message here"
}
```

### Broadcast to All Subscribers

```
POST /broadcast
Authorization: Bearer <SUPER_SECRET_KEY>
Content-Type: application/json

{
  "message": "Broadcast message"
}
```

### Get All Subscriptions

```
GET /subscriptions
Authorization: Bearer <SUPER_SECRET_KEY>
```

## Notes

- Channel names must contain only letters, numbers, and underscores
- Messages are limited to 1000 characters
- The `/broadcast` and `/subscriptions` endpoints require admin authentication
